name: Update Reuters Tech RSS

on:
  schedule:
    - cron: '0 * * * *'  # Runs every hour
  workflow_dispatch:

jobs:
  update-rss:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser lxml

      # 4. Fetch and update RSS feed
      - name: Fetch Reuters Technology via Google News RSS
        run: |
          python << 'EOF'
          import feedparser
          import xml.etree.ElementTree as ET
          from datetime import datetime

          # Google News RSS for Reuters Technology
          RSS_URL = "https://news.google.com/rss/search?q=Reuters+Technology&hl=en-US&gl=US&ceid=US:en"

          # Parse feed
          feed = feedparser.parse(RSS_URL)

          # Create XML root
          rss = ET.Element('rss', version='2.0')
          channel = ET.SubElement(rss, 'channel')
          ET.SubElement(channel, 'title').text = "Reuters Technology via Google News"
          ET.SubElement(channel, 'link').text = "https://www.reuters.com/technology/"
          ET.SubElement(channel, 'description').text = "Latest Reuters Technology articles"
          ET.SubElement(channel, 'lastBuildDate').text = datetime.utcnow().strftime('%a, %d %b %Y %H:%M:%S GMT')

          # Add items (limit to 15)
          for entry in feed.entries[:15]:
              item = ET.SubElement(channel, 'item')
              ET.SubElement(item, 'title').text = entry.title
              ET.SubElement(item, 'link').text = entry.link
              ET.SubElement(item, 'pubDate').text = entry.published
              ET.SubElement(item, 'description').text = entry.summary

          # Save feed.xml
          tree = ET.ElementTree(rss)
          tree.write('feed.xml', encoding='utf-8', xml_declaration=True)
          EOF

      # 5. Commit and push RSS feed
      - name: Commit and push RSS feed
        uses: ad-m/github-push-action@v0.6.0
        with:
          branch: main
          github_token: ${{ secrets.GITHUB_TOKEN }}
          commit_message: "Update Reuters Technology RSS feed"
