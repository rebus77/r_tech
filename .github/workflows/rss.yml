name: Update Tech RSS

on:
  schedule:
    - cron: '0 * * * *'  # runs every hour
  workflow_dispatch:

jobs:
  build-rss:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests feedgen

      # 4. Generate RSS feed using NewsAPI
      - name: Generate RSS feed
        env:
          NEWSAPI_KEY: ${{ secrets.NEWSAPI_KEY }}  # store your NewsAPI key in GitHub secrets
        run: |
          python << 'EOF'
          import os
          import requests
          from feedgen.feed import FeedGenerator
          from datetime import datetime

          NEWSAPI_KEY = os.environ['NEWSAPI_KEY']
          URL = 'https://newsapi.org/v2/top-headlines'
          params = {
              'sources': 'reuters',
              'category': 'technology',
              'pageSize': 15,
              'apiKey': NEWSAPI_KEY
          }

          response = requests.get(URL, params=params)
          response.raise_for_status()
          data = response.json()
          articles = data.get('articles', [])

          fg = FeedGenerator()
          fg.title('Reuters Technology News')
          fg.link(href='https://www.reuters.com/technology/', rel='alternate')
          fg.description('Latest technology news from Reuters')
          fg.language('en')

          for article in articles:
              fe = fg.add_entry()
              fe.title(article.get('title', 'No title'))
              fe.link(href=article.get('url', ''))
              fe.description(article.get('description', ''))
              fe.pubDate(article.get('publishedAt', datetime.utcnow().isoformat()))

          fg.rss_file('rss.xml')
          EOF

      # 5. Commit and push RSS feed
      - name: Commit and push RSS feed
        uses: ad-m/github-push-action@v0.6.0
        with:
          branch: main
          github_token: ${{ secrets.GITHUB_TOKEN }}
          commit_message: "Update RSS feed"
